var A=Object.defineProperty;var T=(s,t,e)=>t in s?A(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var l=(s,t,e)=>T(s,typeof t!="symbol"?t+"":t,e);import{r as f,j as o}from"./index-C67IWVwa.js";const y=new Map([["aden",{"hue-rotate":-20,contrast:.9,brightness:1.2,saturate:.85}],["inkwell",{sepia:.3,contrast:1.1,brightness:1.1,grayscale:1}],["reyes",{sepia:.22,contrast:.85,brightness:1.1,saturate:.75}],["gingham",{"hue-rotate":-10,brightness:1.05}],["toaster",{contrast:1.5,brightness:.9}],["walden",{"hue-rotate":-10,brightness:1.1,sepia:.3,saturate:1.6}],["hudson",{brightness:1.2,contrast:.9,saturate:1.1}],["earlybird",{contrast:.9,sepia:.2}],["mayfair",{contrast:1.1,saturate:1.1}],["lofi",{contrast:1.5,saturate:1.1}],["1977",{contrast:1.1,brightness:1.1,saturate:1.3}],["brooklyn",{contrast:.9,brightness:1.1}],["xpro2",{sepia:.3}],["nashville",{contrast:1.2,brightness:1.05,saturate:1.2,sepia:.2}],["lark",{contrast:.9}],["moon",{brightness:1.1,contrast:1.1,grayscale:1}],["clarendon",{contrast:1.2,saturate:1.35}],["willow",{contrast:.95,brightness:.9,grayscale:.5}],["rise",{contrast:.9,brightness:1.05,sepia:.2,saturate:.9}],["slumber",{brightness:1.05,saturate:.66}],["brannan",{contrast:1.4,sepia:.5}],["valencia",{contrast:1.08,brightness:1.08,sepia:.08}],["maven",{contrast:.95,brightness:1.95,saturate:1.5,sepia:.25}],["stinson",{contrast:.75,brightness:1.15,saturate:.85}],["amaro",{"hue-rotate":-10,contrast:.9,brightness:1.1,saturate:1.5}]]),k=typeof OffscreenCanvas<"u";function v(s,t="internal error."){if(!s)throw Error(`[CCgram] ${t}`)}function x(s){v(s&&s.tagName==="IMG","The first argument is required and must be an <img> element."),v(s.src,"The <img> element src attribute is empty.")}function S({data:s}){const{canvas:t,image:e,filterStyle:a,options:r}=s,n=t.getContext("2d",{alpha:!1});if(!n)throw new Error("The 2d context canvas is not supported.");return n.filter=a,n.drawImage(e,0,0),t.convertToBlob(r)}const F="filter";class b{constructor({dataAttribute:t=F,init:e=!0}={}){l(this,"_filters",y);l(this,"_dataAttribute");l(this,"_dataAttributeKey");if(this._dataAttribute=t,this._dataAttributeKey=t.replace(/-./g,r=>r[1]?r[1].toUpperCase():""),!e)return;if(document.readyState==="complete")return void this.applyFilter();const a=()=>{this.applyFilter(),document.removeEventListener("DOMContentLoaded",a)};document.addEventListener("DOMContentLoaded",a)}get filterNames(){return[...this._filters.keys()]}setFilter(t,e){this._filters.set(t,e)}removeFilter(t){return this._filters.delete(t)}getFilterSetting(t=""){return this._filters.get(t)}getFilterStyle(t=""){return function(e){return e?Object.keys(e).map(a=>`${a}(${e[a]}${a==="hue-rotate"?"deg":a==="blur"?"px":""})`).join(" "):"none"}(this._filters.get(t))}applyFilter(t=`img[data-${this._dataAttribute}]`){document.querySelectorAll(t).forEach(e=>{const{dataset:a}=e;e.style.setProperty("filter",this.getFilterStyle(a[this._dataAttributeKey]))})}async getDataURL(t,e={}){x(t);const a=await this.getBlob(t,e);if(!a)return null;const r=new FileReader;return new Promise(n=>{r.addEventListener("load",()=>{n(r.result)}),r.readAsDataURL(a)})}async getBlob(t,e={}){x(t);const{naturalWidth:a,naturalHeight:r}=t,n=e.filter??t.dataset[this._dataAttributeKey],c=this.getFilterStyle(n);if(k){const d=new OffscreenCanvas(a,r),u=await createImageBitmap(t);return new Promise(C=>{const h=function(p){const L=`
    const work = ${p.toString()};

    addEventListener('message', async (...params) => {
      const res = await work(...params);
      postMessage(res);
    });
  `,w=URL.createObjectURL(new Blob([L],{type:"text/javascript"})),g=new Worker(w),{terminate:_}=g;return g.terminate=()=>{URL.revokeObjectURL(w),_.call(g)},g}(S);h.addEventListener("message",({data:p})=>{C(p),h.terminate()}),h.postMessage({canvas:d,image:u,filterStyle:c,options:e},[d,u])})}const i=document.createElement("canvas");i.width=a,i.height=r;const m=i.getContext("2d",{alpha:!1});if(!m)throw new Error("The 2d context canvas is not supported.");m.filter=c,m.drawImage(t,0,0);const{type:E,quality:j}=e;return new Promise(d=>i.toBlob(u=>d(u),E,j))}}l(b,"DEFAULT_DATA_ATTRIBUTE",F),l(b,"DEFAULT_FILTERS",y);const R=b;function U(s){return new R(s)}const D=({initialFilterName:s=""}={})=>{const[t,e]=f.useState(s),a=U({init:!1});return f.useEffect(()=>{a.applyFilter()},[t,a]),{selectedFilterName:t,setSelectedFilterName:e,filter:a}},N=({filter:s})=>{const t=f.useRef(null);return{imageRef:t,download:async({downloadFileName:a="download"}={})=>{const{current:r}=t;if(!r||!(r instanceof HTMLImageElement))throw new TypeError("ref must be an image");const n=document.createElement("a");n.href=await s.getDataURL(r,{type:"image/jpeg"})||"",n.download=a,n.click()}}},M=({imageURL:s,onClear:t})=>{const{filter:e,selectedFilterName:a,setSelectedFilterName:r}=D(),{imageRef:n,download:c}=N({filter:e});return s?o.jsxs("div",{className:"preview",children:[o.jsxs("div",{className:"image-container",children:[o.jsx("img",{id:"preview-image",src:s,"data-filter":a,alt:a.toUpperCase(),ref:n}),o.jsx("button",{type:"button",className:"btn btn-cross",onClick:t,"aria-label":"Clear image",children:o.jsx("i",{className:"fa fa-times"})}),o.jsx("button",{type:"button",className:"btn btn-download",onClick:()=>c({downloadFileName:a}),"aria-label":"Download image",children:o.jsx("i",{className:"fas fa-cloud-download-alt"})})]}),o.jsx("div",{className:"filters-container",children:e.filterNames.map(i=>o.jsxs("figure",{role:"button",className:a===i?"selected":"",onClick:()=>r(i),onKeyPress:()=>r(i),children:[o.jsx("img",{src:s,"data-filter":i,alt:i.toUpperCase()}),o.jsx("figcaption",{children:i.toUpperCase()})]},i))})]}):null};export{M as Preview,M as default};
//# sourceMappingURL=index-B5CEYwAL.js.map
